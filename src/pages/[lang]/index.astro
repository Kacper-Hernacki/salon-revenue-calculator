---
import Layout from '../../layouts/Layout.astro';
import LanguageSelector from '../../components/LanguageSelector.astro';
import Tooltip from '../../components/Tooltip.astro';
import { useTranslations, formatCurrency, getTextDirection, getCurrencySymbol, type Lang } from '../../i18n/utils';
import { languages } from '../../i18n/config';

export async function getStaticPaths() {
  return Object.keys(languages).map((lang) => ({
    params: { lang },
  }));
}

const lang = Astro.params.lang as Lang;
const t = useTranslations(lang);
const dir = getTextDirection(lang);
const currencySymbol = getCurrencySymbol(lang);

// SEO metadata
const title = t('page.title');
const description = t('page.description');
---

<Layout title={title} description={description}>
  <div class="background-pattern" aria-hidden="true"></div>

  <main class="calculator-container" role="main" dir={dir}>
    <!-- Language selector at top of modal -->
    <div class="modal-language-selector">
      <LanguageSelector currentLang={lang} variant="modal" />
    </div>
    
    <header class="header">
      <span class="badge" role="img" aria-label={t('header.badge')}>
        <svg class="badge-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
          <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z" clip-rule="evenodd"/>
        </svg>
        {t('header.badge')}
      </span>
      <h1>{t('header.title')}</h1>
      <p class="subtitle">{t('header.subtitle')}</p>
    </header>

    <section class="calculator-body">
      <form id="revenueCalculator" aria-labelledby="calculator-title">
        <h2 id="calculator-title" class="visually-hidden">{t('form.title')}</h2>
        
        <div class="input-group">
          <label for="monthlyClients">{t('form.monthlyClients.label')}</label>
          <div class="input-wrapper">
            <svg class="input-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
              <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
            </svg>
            <input 
              type="number" 
              id="monthlyClients" 
              min="0" 
              max="10000"
              value="200" 
              required 
              aria-describedby="monthlyClients-help"
            />
          </div>
          <Tooltip content={t('form.monthlyClients.tooltip')}>
            <div class="help-text" id="monthlyClients-help">
              <svg class="help-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
              </svg>
              <span>{t('form.monthlyClients.help')}</span>
            </div>
          </Tooltip>
        </div>

        <div class="input-group">
          <label for="avgTicket">{t('form.avgTicket.label')} ({currencySymbol})</label>
          <div class="input-wrapper">
            <svg class="input-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
              <path d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z"/>
            </svg>
            <input 
              type="number" 
              id="avgTicket" 
              min="0" 
              max="1000"
              value="75" 
              step="0.01" 
              required 
              aria-describedby="avgTicket-help"
            />
          </div>
          <Tooltip content={t('form.avgTicket.tooltip')}>
            <div class="help-text" id="avgTicket-help">
              <svg class="help-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
              </svg>
              <span>{t('form.avgTicket.help')}</span>
            </div>
          </Tooltip>
        </div>

        <div class="input-group">
          <label for="rebookRate">{t('form.rebookRate.label')}</label>
          <div class="input-wrapper">
            <svg class="input-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
              <path d="M2 10a8 8 0 118-8v8h8a8 8 0 11-16 0z"/>
              <path d="M12 2.252A8.014 8.014 0 0117.748 8H12V2.252z"/>
            </svg>
            <input 
              type="number" 
              id="rebookRate" 
              min="0" 
              max="100" 
              value="40" 
              required 
              aria-describedby="rebookRate-help"
            />
          </div>
          <Tooltip content={t('form.rebookRate.tooltip')}>
            <div class="help-text" id="rebookRate-help">
              <svg class="help-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
              </svg>
              <span>{t('form.rebookRate.help')}</span>
            </div>
          </Tooltip>
        </div>

        <div class="input-group">
          <label for="avgVisitsYear">{t('form.avgVisits.label')}</label>
          <div class="input-wrapper">
            <svg class="input-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
              <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
            </svg>
            <input 
              type="number" 
              id="avgVisitsYear" 
              min="1" 
              max="52" 
              value="6" 
              required 
              aria-describedby="avgVisitsYear-help"
            />
          </div>
          <Tooltip content={t('form.avgVisits.tooltip')}>
            <div class="help-text" id="avgVisitsYear-help">
              <svg class="help-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
              </svg>
              <span>{t('form.avgVisits.help')}</span>
            </div>
          </Tooltip>
        </div>

        <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 24px;">
          {t('form.submit')}
        </button>
      </form>

      <section id="results" class="results-section" aria-live="polite" aria-label="Calculation Results">
        <h2 style="margin-bottom: 24px; color: var(--dark);">{t('results.title')}</h2>
        
        <div class="metric-card">
          <div class="metric-label">{t('results.current.label')}</div>
          <div class="metric-value" id="currentRevenue" aria-label={t('results.current.aria')}>{formatCurrency(0, lang)}</div>
        </div>

        <div class="metric-card">
          <div class="metric-label">{t('results.lost.label')}</div>
          <div class="metric-value highlight" id="lostRevenue" aria-label={t('results.lost.aria')}>{formatCurrency(0, lang)}</div>
          <div class="metric-change">
            <svg class="metric-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
              <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
            </svg>
            <span id="lostPercentage" aria-label="Percentage of revenue lost">0%</span> {t('results.lost.text')}
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-label">{t('results.potential.label')}</div>
          <div class="metric-value" id="potentialRevenue" aria-label={t('results.potential.aria')}>{formatCurrency(0, lang)}</div>
          <div class="metric-change">
            <svg class="metric-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
              <path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
            </svg>
            <span id="increaseAmount" aria-label="Potential increase amount">{formatCurrency(0, lang)}</span> {t('results.potential.text')}
          </div>
        </div>

        <div class="metric-card highlight-card">
          <div class="metric-label">{t('results.annual.label')}</div>
          <div class="metric-value highlight" id="annualOpportunity" aria-label={t('results.annual.aria')}>{formatCurrency(0, lang)}</div>
          <div class="metric-change">
            <svg class="metric-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
              <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z" clip-rule="evenodd"/>
            </svg>
            <span>{t('results.annual.text')}</span>
          </div>
        </div>

        <div class="cta-section">
          <h3 class="cta-title">{t('cta.title')}</h3>
          <p class="cta-subtitle">{t('cta.subtitle')}</p>
          
          <div class="email-capture">
            <p style="margin-bottom: 16px; color: var(--dark); font-weight: 600;">
              <svg class="email-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
              </svg>
              {t('cta.email.title')}
            </p>
            <form id="emailForm" class="email-form" aria-label="Email Subscription Form">
              <label for="email" class="visually-hidden">{t('cta.email.label')}</label>
              <input 
                type="email" 
                id="email" 
                placeholder={t('cta.email.placeholder')}
                required 
                aria-describedby="email-help"
              />
              <div id="email-help" class="visually-hidden">{t('cta.email.help')}</div>
              <button type="submit" class="btn btn-primary">{t('cta.email.submit')}</button>
            </form>
          </div>

        </div>
      </section>

      <div class="loading-container" id="loadingContainer" style="display: none;">
        <div class="loading-spinner" id="spinner" aria-hidden="true"></div>
        <p class="loading-text" id="loadingText">{t('loading.calculating')}</p>
      </div>
    </section>
  </main>
</Layout>

<script is:inline>
  // Store current language for JavaScript functions
  window.currentLang = document.documentElement.lang;
  
  // Format currency based on current language
  function formatCurrency(amount, lang = window.currentLang) {
    const locales = {
      en: 'en-US', es: 'es-ES', fr: 'fr-FR', pl: 'pl-PL',
      ar: 'ar-SA', ru: 'ru-RU', zh: 'zh-CN', it: 'it-IT', ja: 'ja-JP'
    };

    const currencies = {
      en: 'USD', es: 'EUR', fr: 'EUR', pl: 'PLN',
      ar: 'SAR', ru: 'RUB', zh: 'CNY', it: 'EUR', ja: 'JPY'
    };

    try {
      return new Intl.NumberFormat(locales[lang] || 'en-US', {
        style: 'currency',
        currency: currencies[lang] || 'USD',
        minimumFractionDigits: lang === 'ja' ? 0 : 2,
        maximumFractionDigits: lang === 'ja' ? 0 : 2,
      }).format(amount);
    } catch (error) {
      return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
      }).format(amount);
    }
  }

  // Main calculator logic
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('revenueCalculator');
    const emailForm = document.getElementById('emailForm');
    const resultsSection = document.getElementById('results');
    const loadingContainer = document.getElementById('loadingContainer');
    const loadingText = document.getElementById('loadingText');

    if (form) {
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form values
        const monthlyClients = parseFloat(document.getElementById('monthlyClients').value) || 200;
        const avgTicket = parseFloat(document.getElementById('avgTicket').value) || 75;
        const rebookRate = parseFloat(document.getElementById('rebookRate').value) || 40;
        // const avgVisitsYear = parseFloat(document.getElementById('avgVisitsYear').value) || 6;
        
        // Show loading
        loadingContainer.style.display = 'flex';
        loadingText.textContent = window.currentLang === 'en' ? 'Calculating your revenue potential...' :
          window.currentLang === 'es' ? 'Calculando tu potencial de ingresos...' :
          window.currentLang === 'fr' ? 'Calcul de votre potentiel de revenus...' :
          window.currentLang === 'pl' ? 'Obliczanie twojego potencjału przychodów...' :
          window.currentLang === 'ar' ? 'حساب إمكانات الإيرادات الخاصة بك...' :
          window.currentLang === 'ru' ? 'Расчитываем ваш потенциал доходов...' :
          window.currentLang === 'zh' ? '计算您的收入潜力...' :
          window.currentLang === 'it' ? 'Calcolo del tuo potenziale di ricavi...' :
          window.currentLang === 'ja' ? 'あなたの収益ポテンシャルを計算中...' :
          'Calculating your revenue potential...';
          
        // Switch to analyzing text after 1 second
        setTimeout(() => {
          if (loadingContainer.style.display === 'flex') {
            loadingText.textContent = window.currentLang === 'en' ? 'Analyzing your data with AI...' :
              window.currentLang === 'es' ? 'Analizando tus datos con IA...' :
              window.currentLang === 'fr' ? 'Analyse de vos données avec l\'IA...' :
              window.currentLang === 'pl' ? 'Analizowanie twoich danych z AI...' :
              window.currentLang === 'ar' ? 'تحليل بياناتك باستخدام الذكاء الاصطناعي...' :
              window.currentLang === 'ru' ? 'Анализируем ваши данные с помощью ИИ...' :
              window.currentLang === 'zh' ? '使用AI分析您的数据...' :
              window.currentLang === 'it' ? 'Analisi dei tuoi dati con IA...' :
              window.currentLang === 'ja' ? 'AIでデータを分析中...' :
              'Analyzing your data with AI...';
          }
        }, 1000);
        
        setTimeout(() => {
          // Calculate metrics
          const currentMonthlyRevenue = monthlyClients * avgTicket;
          
          // Calculate potential with improved rebooking
          const idealRebookRate = 85; // Industry best practice
          const rebookImprovement = (idealRebookRate - rebookRate) / 100;
          const additionalRebookings = monthlyClients * rebookImprovement;
          const lostMonthlyRevenue = additionalRebookings * avgTicket;
          const potentialMonthlyRevenue = currentMonthlyRevenue + lostMonthlyRevenue;
          
          // Annual calculations
          const annualOpportunity = lostMonthlyRevenue * 12;
          const lostPercentage = ((lostMonthlyRevenue / potentialMonthlyRevenue) * 100).toFixed(1);
          
          // Update display
          document.getElementById('currentRevenue').textContent = formatCurrency(currentMonthlyRevenue);
          document.getElementById('lostRevenue').textContent = formatCurrency(lostMonthlyRevenue);
          document.getElementById('potentialRevenue').textContent = formatCurrency(potentialMonthlyRevenue);
          document.getElementById('annualOpportunity').textContent = formatCurrency(annualOpportunity);
          document.getElementById('lostPercentage').textContent = lostPercentage + '%';
          document.getElementById('increaseAmount').textContent = formatCurrency(lostMonthlyRevenue);
          
          // Hide loading and show results
          loadingContainer.style.display = 'none';
          resultsSection.classList.add('show');
          resultsSection.style.display = 'block';
          
          // Scroll to results
          resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
          
          // Analytics tracking
          if (typeof gtag !== 'undefined') {
            gtag('event', 'calculator_completed', {
              event_category: 'engagement',
              event_label: 'revenue_calculation',
              value: Math.round(lostMonthlyRevenue)
            });
          }
          
          if (typeof fbq !== 'undefined') {
            fbq('track', 'CompleteRegistration', {
              content_name: 'Revenue Calculator',
              value: Math.round(lostMonthlyRevenue),
              currency: currencies[window.currentLang] || 'USD'
            });
          }
          
        }, 1500);
      });
    }

    // Email form handling
    if (emailForm) {
      emailForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const email = document.getElementById('email').value;
        const submitButton = emailForm.querySelector('button[type="submit"]');
        const originalText = submitButton.textContent;
        
        if (!email || !email.includes('@')) {
          alert('Please enter a valid email address');
          return;
        }
        
        submitButton.textContent = '...';
        submitButton.disabled = true;
        
        // Simulate API call
        setTimeout(() => {
          // Success feedback
          submitButton.textContent = '✓ Sent!';
          submitButton.style.background = 'var(--success)';
          
          // Analytics
          if (typeof gtag !== 'undefined') {
            gtag('event', 'email_submitted', {
              event_category: 'conversion',
              event_label: 'lead_generation'
            });
          }
          
          if (typeof fbq !== 'undefined') {
            fbq('track', 'Lead', {
              content_name: 'Email Submission'
            });
          }
          
          // Reset after delay
          setTimeout(() => {
            submitButton.textContent = originalText;
            submitButton.disabled = false;
            submitButton.style.background = '';
            emailForm.reset();
          }, 3000);
          
        }, 1000);
      });
    }
  });
</script>

<style>
  /* All styles from RevenueCalculator.astro */
  .visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  .background-pattern {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0.1;
    background-image: 
      repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(255,255,255,.1) 35px, rgba(255,255,255,.1) 70px);
    pointer-events: none;
  }

  .calculator-container {
    background: white;
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    max-width: 700px;
    width: 100%;
    overflow: hidden;
    position: relative;
    animation: slideUp 0.6s ease-out;
  }

  .modal-language-selector {
    position: absolute;
    top: 20px;
    right: 20px;
    z-index: 1000;
  }

  /* RTL support for language selector position */
  [dir="rtl"] .modal-language-selector {
    left: 20px;
    right: auto;
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .header {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    padding: 30px 24px;
    text-align: center;
    color: white;
    position: relative;
  }

  .badge {
    display: inline-block;
    background: rgba(255, 255, 255, 0.2);
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 16px;
    backdrop-filter: blur(10px);
  }

  h1 {
    font-size: 2rem;
    margin-bottom: 12px;
    font-weight: 700;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .subtitle {
    font-size: 1rem;
    opacity: 0.95;
    max-width: 400px;
    margin: 0 auto;
    line-height: 1.5;
  }

  .calculator-body {
    padding: 30px 24px;
  }

  .input-group {
    margin-bottom: 20px;
    animation: fadeIn 0.8s ease-out forwards;
    opacity: 0;
  }

  .input-group:nth-child(2) { animation-delay: 0.1s; }
  .input-group:nth-child(3) { animation-delay: 0.2s; }
  .input-group:nth-child(4) { animation-delay: 0.3s; }
  .input-group:nth-child(5) { animation-delay: 0.4s; }

  @keyframes fadeIn {
    to {
      opacity: 1;
    }
  }

  label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--dark);
    font-size: 0.95rem;
  }

  .input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
  }

  .input-icon {
    position: absolute;
    left: 16px;
    color: var(--primary);
    width: 20px;
    height: 20px;
    z-index: 1;
  }

  .badge-icon {
    width: 16px;
    height: 16px;
    display: inline-block;
    margin-right: 8px;
    vertical-align: middle;
  }

  .help-icon {
    width: 16px;
    height: 16px;
    flex-shrink: 0;
  }

  .metric-icon {
    width: 16px;
    height: 16px;
    flex-shrink: 0;
  }

  .email-icon {
    width: 18px;
    height: 18px;
    display: inline-block;
    margin-right: 8px;
    vertical-align: middle;
  }

  input[type="number"],
  input[type="email"],
  input[type="text"],
  input[type="tel"] {
    width: 100%;
    padding: 14px 16px 14px 48px;
    border: 2px solid #E5E7EB;
    border-radius: 12px;
    font-size: 16px;
    transition: all 0.3s ease;
    background: #FAFAFA;
  }

  /* RTL adjustments */
  [dir="rtl"] input[type="number"],
  [dir="rtl"] input[type="email"],
  [dir="rtl"] input[type="text"],
  [dir="rtl"] input[type="tel"] {
    padding: 14px 48px 14px 16px;
  }

  [dir="rtl"] .input-icon {
    left: auto;
    right: 16px;
  }

  input:focus {
    outline: none;
    border-color: var(--primary);
    background: white;
    box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
  }

  .help-text {
    font-size: 0.85rem;
    color: #6B7280;
    margin-top: 6px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .results-section {
    background: linear-gradient(135deg, #F3F4F6 0%, #FAFAFF 100%);
    padding: 32px;
    border-radius: 16px;
    margin-top: 32px;
    display: none;
    border: 2px solid #E5E7EB;
  }

  .results-section.show {
    display: block;
    animation: slideIn 0.5s ease-out;
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .metric-card {
    background: white;
    padding: 24px;
    border-radius: 12px;
    margin-bottom: 20px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    border: 1px solid #E5E7EB;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .metric-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 12px rgba(0, 0, 0, 0.1);
  }

  .highlight-card {
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
  }

  .metric-label {
    font-size: 0.9rem;
    color: #6B7280;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .metric-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--dark);
    margin-bottom: 4px;
  }

  .metric-value.highlight {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .metric-change {
    font-size: 0.95rem;
    color: var(--success);
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .cta-section {
    margin-top: 32px;
    padding: 32px;
    background: linear-gradient(135deg, rgba(139, 92, 246, 0.05) 0%, rgba(236, 72, 153, 0.05) 100%);
    border-radius: 16px;
    text-align: center;
    border: 2px dashed rgba(139, 92, 246, 0.3);
  }

  .cta-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--dark);
    margin-bottom: 12px;
  }

  .cta-subtitle {
    color: #6B7280;
    margin-bottom: 24px;
    font-size: 1.05rem;
  }

  .btn {
    padding: 16px 32px;
    border: none;
    border-radius: 12px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
    position: relative;
    overflow: hidden;
  }

  .btn-primary {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    color: white;
    box-shadow: 0 4px 14px rgba(139, 92, 246, 0.4);
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.5);
  }

  .btn-primary:focus {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
  }

  .btn-primary::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
  }

  .btn-primary:active::after {
    width: 300px;
    height: 300px;
  }

  .email-capture {
    background: white;
    padding: 24px;
    border-radius: 12px;
    margin-top: 20px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
  }

  .email-form {
    display: flex;
    gap: 12px;
    margin-top: 16px;
  }

  .email-form input {
    flex: 1;
  }

  .trust-indicators {
    display: flex;
    justify-content: center;
    gap: 40px;
    margin-top: 32px;
    padding-top: 32px;
    border-top: 1px solid #E5E7EB;
    flex-wrap: wrap;
  }

  .trust-item {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #6B7280;
    font-size: 0.9rem;
  }

  .trust-item svg {
    color: var(--success);
  }

  .loading-container {
    text-align: center;
    padding: 40px;
    background: rgba(255, 255, 255, 0.95);
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    backdrop-filter: blur(5px);
  }

  .loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #E5E7EB;
    border-top-color: var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 16px;
  }

  .loading-text {
    color: var(--dark);
    font-size: 1rem;
    font-weight: 500;
    margin: 0;
    animation: pulse 2s ease-in-out infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
  }

  @media (max-width: 768px) {
    .calculator-container {
      max-width: 95%;
      margin: 10px auto;
    }
    
    h1 {
      font-size: 1.6rem;
    }
    
    .header {
      padding: 24px 20px;
    }
    
    .calculator-body {
      padding: 20px;
    }
    
    .input-group {
      margin-bottom: 16px;
    }
    
    .email-form {
      flex-direction: column;
    }
    
    .metric-value {
      font-size: 2rem;
    }

    .trust-indicators {
      gap: 20px;
    }

    .modal-language-selector {
      top: 16px;
      right: 16px;
    }

    [dir="rtl"] .modal-language-selector {
      left: 16px;
      right: auto;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .calculator-container,
    .input-group,
    .results-section {
      animation: none;
    }
    
    .btn {
      transition: none;
    }
  }
</style>