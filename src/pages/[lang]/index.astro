---
import Layout from '../../layouts/Layout.astro';
import LanguageSelector from '../../components/LanguageSelector.astro';
import Tooltip from '../../components/Tooltip.astro';
import { useTranslations, formatCurrency, getTextDirection, getCurrencySymbol, type Lang } from '../../i18n/utils';
import { languages } from '../../i18n/config';

export async function getStaticPaths() {
  return Object.keys(languages).map((lang) => ({
    params: { lang },
  }));
}

const lang = Astro.params.lang as Lang;
const t = useTranslations(lang);
const dir = getTextDirection(lang);
const currencySymbol = getCurrencySymbol(lang);

// SEO metadata
const title = t('page.title');
const description = t('page.description');
---

<Layout title={title} description={description}>
  <div class="background-pattern" aria-hidden="true"></div>

  <main class="calculator-container" role="main" dir={dir}>
    <header class="header">
      <span class="badge" role="img" aria-label={t('header.badge')}>
        <svg class="badge-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
          <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z" clip-rule="evenodd"/>
        </svg>
        {t('header.badge')}
      </span>
      
      <!-- Language selector below badge -->
      <div class="header-language-selector">
        <LanguageSelector currentLang={lang} variant="modal" />
      </div>
      
      <h1>{t('header.title')}</h1>
      <p class="subtitle">{t('header.subtitle')}</p>
    </header>

    <section class="calculator-body">
      <form id="revenueCalculator" aria-labelledby="calculator-title">
        <h2 id="calculator-title" class="visually-hidden">{t('form.title')}</h2>
        
        <div class="input-group">
          <label for="monthlyClients">{t('form.monthlyClients.label')}</label>
          <div class="input-wrapper">
            <svg class="input-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
              <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
            </svg>
            <input 
              type="number" 
              id="monthlyClients" 
              min="0" 
              max="10000"
              value="200" 
              required 
              aria-describedby="monthlyClients-help"
            />
          </div>
          <Tooltip content={t('form.monthlyClients.tooltip')}>
            <div class="help-text" id="monthlyClients-help">
              <svg class="help-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
              </svg>
              <span>{t('form.monthlyClients.help')}</span>
            </div>
          </Tooltip>
        </div>

        <div class="input-group">
          <label for="avgTicket">{t('form.avgTicket.label')} ({currencySymbol})</label>
          <div class="input-wrapper">
            <svg class="input-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
              <path d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm6 4a2 2 0 100-4 2 2 0 000 4z"/>
            </svg>
            <input 
              type="number" 
              id="avgTicket" 
              min="0" 
              max="1000"
              value="75" 
              step="0.01" 
              required 
              aria-describedby="avgTicket-help"
            />
          </div>
          <Tooltip content={t('form.avgTicket.tooltip')}>
            <div class="help-text" id="avgTicket-help">
              <svg class="help-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
              </svg>
              <span>{t('form.avgTicket.help')}</span>
            </div>
          </Tooltip>
        </div>

        <div class="input-group">
          <label for="rebookRate">{t('form.rebookRate.label')}</label>
          <div class="input-wrapper">
            <svg class="input-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
              <path d="M2 10a8 8 0 118-8v8h8a8 8 0 11-16 0z"/>
              <path d="M12 2.252A8.014 8.014 0 0117.748 8H12V2.252z"/>
            </svg>
            <input 
              type="number" 
              id="rebookRate" 
              min="0" 
              max="85" 
              value="40" 
              required 
              aria-describedby="rebookRate-help"
            />
          </div>
          <Tooltip content={t('form.rebookRate.tooltip')}>
            <div class="help-text" id="rebookRate-help">
              <svg class="help-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
              </svg>
              <span>{t('form.rebookRate.help')}</span>
            </div>
          </Tooltip>
        </div>

        <div class="input-group">
          <label for="avgVisitsYear">{t('form.avgVisits.label')}</label>
          <div class="input-wrapper">
            <svg class="input-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
              <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
            </svg>
            <input 
              type="number" 
              id="avgVisitsYear" 
              min="1" 
              max="52" 
              value="6" 
              required 
              aria-describedby="avgVisitsYear-help"
            />
          </div>
          <Tooltip content={t('form.avgVisits.tooltip')}>
            <div class="help-text" id="avgVisitsYear-help">
              <svg class="help-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
              </svg>
              <span>{t('form.avgVisits.help')}</span>
            </div>
          </Tooltip>
        </div>

        <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 24px;">
          {t('form.submit')}
        </button>
      </form>

      <section id="results" class="results-section" aria-live="polite" aria-label="Calculation Results">
        <h2 style="margin-bottom: 24px; color: var(--dark);">{t('results.title')}</h2>
        
        <!-- Calculation explanation -->
        <div class="calculation-explanation">
          <h3 class="explanation-title">
            <svg class="title-icon" fill="currentColor" viewBox="0 0 20 20">
              <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
            </svg>
            {t('calc.explanation.title')}
          </h3>
          <div class="explanation-content">
            <p>{t('calc.explanation.intro')}</p>
            <div class="calculation-steps">
              <div class="step">
                <span class="step-number">1</span>
                <div class="step-content">
                  {t('calc.explanation.step1')}
                </div>
              </div>
              <div class="step">
                <span class="step-number">2</span>
                <div class="step-content">
                  {t('calc.explanation.step2')}
                </div>
              </div>
              <div class="step">
                <span class="step-number">3</span>
                <div class="step-content">
                  {t('calc.explanation.step3')}
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="metric-card">
          <div class="metric-label">{t('results.current.label')}</div>
          <div class="metric-value" id="currentRevenue" aria-label={t('results.current.aria')}>{formatCurrency(0, lang)}</div>
        </div>

        <div class="metric-card">
          <div class="metric-label">{t('results.lost.label')}</div>
          <div class="metric-value highlight" id="lostRevenue" aria-label={t('results.lost.aria')}>{formatCurrency(0, lang)}</div>
          <div class="metric-change">
            <svg class="metric-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
              <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
            </svg>
            <span id="lostPercentage" aria-label="Percentage of revenue lost">0%</span> {t('results.lost.text')}
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-label">{t('results.potential.label')}</div>
          <div class="metric-value" id="potentialRevenue" aria-label={t('results.potential.aria')}>{formatCurrency(0, lang)}</div>
          <div class="metric-change">
            <svg class="metric-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
              <path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
            </svg>
            <span id="increaseAmount" aria-label="Potential increase amount">{formatCurrency(0, lang)}</span> {t('results.potential.text')}
          </div>
        </div>

        <div class="metric-card highlight-card">
          <div class="metric-label">{t('results.annual.label')}</div>
          <div class="metric-value highlight" id="annualOpportunity" aria-label={t('results.annual.aria')}>{formatCurrency(0, lang)}</div>
          <div class="metric-change">
            <svg class="metric-icon" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
              <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z" clip-rule="evenodd"/>
            </svg>
            <span>{t('results.annual.text')}</span>
          </div>
        </div>

        <!-- How our solution helps -->
        <div class="solution-explanation">
          <h3 class="solution-title">
            <svg class="title-icon" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
            </svg>
            {t('solution.title')}
          </h3>
          <div class="solution-content">
            <p class="solution-intro">{t('solution.intro')}</p>
            
            <div class="solution-features">
              <div class="solution-feature">
                <div class="feature-header">
                  <svg class="feature-icon" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z" clip-rule="evenodd"/>
                  </svg>
                  <h4>{t('solution.feature1.title')}</h4>
                </div>
                <p>{t('solution.feature1.desc')}</p>
              </div>
              
              <div class="solution-feature">
                <div class="feature-header">
                  <svg class="feature-icon" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                    <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                  </svg>
                  <h4>{t('solution.feature2.title')}</h4>
                </div>
                <p>{t('solution.feature2.desc')}</p>
              </div>
              
              <div class="solution-feature">
                <div class="feature-header">
                  <svg class="feature-icon" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd"/>
                  </svg>
                  <h4>{t('solution.feature3.title')}</h4>
                </div>
                <p>{t('solution.feature3.desc')}</p>
              </div>
              
              <div class="solution-feature highlight-feature">
                <div class="feature-header">
                  <svg class="feature-icon" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.293l-3-3a1 1 0 00-1.414 1.414L10.586 9.5H7a1 1 0 100 2h3.586l-1.293 1.293a1 1 0 101.414 1.414l3-3a1 1 0 000-1.414z" clip-rule="evenodd"/>
                  </svg>
                  <h4>{t('solution.feature4.title')}</h4>
                </div>
                <p>{t('solution.feature4.desc')}</p>
              </div>
            </div>
            
            <div class="pilot-program">
              <div class="pilot-header">
                <svg class="pilot-icon" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                <h4>{t('pilot.title')}</h4>
              </div>
              <div class="pilot-content">
                <p><strong>{t('pilot.intro')}</strong></p>
                <ul class="pilot-features">
                  <li>{t('pilot.feature1')}</li>
                  <li>{t('pilot.feature2')}</li>
                  <li>{t('pilot.feature3')}</li>
                  <li>{t('pilot.feature4')}</li>
                </ul>
                <button class="pilot-cta-button" onclick="scrollToWaitlist()">
                  <svg class="cta-icon" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
                  </svg>
                  {t('pilot.cta')}
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="cta-section">
          <!-- Promotional content section -->
          <div class="promo-section">
            <h3 class="promo-title">{t('solution.title')}</h3>
            <p class="promo-subtitle">{t('solution.intro')}</p>
            
            <div class="features-list">
              <div class="feature-item">
                <svg class="feature-icon" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                <span>{t('solution.feature1.title')}</span>
              </div>
              <div class="feature-item">
                <svg class="feature-icon" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                <span>{t('solution.feature2.title')}</span>
              </div>
              <div class="feature-item">
                <svg class="feature-icon" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                </svg>
                <span>{t('solution.feature3.title')}</span>
              </div>
            </div>
          </div>

          <!-- Join waitlist section -->
          <div class="waitlist-section">
            <h3 class="waitlist-title">{t('waitlist.title')}</h3>
            <p class="waitlist-subtitle">{t('waitlist.subtitle')}</p>
            
            <div class="schedule-call-section">
              <p class="schedule-text">{t('schedule.or')}</p>
              <a href="https://smart-schedule.app/book/f83fa392-6f50-4cf0-ae2f-06261edf41d6" target="_blank" class="schedule-link">
                <svg class="calendar-icon" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
                </svg>
                {t('schedule.cta')}
              </a>
            </div>
            
            <div class="email-capture">
              <form id="emailForm" class="email-form" aria-label="Email Subscription Form">
                <div class="email-input-container">
                  <label for="email" class="email-label">{t('waitlist.email.label')}</label>
                  <input 
                    type="email" 
                    id="email" 
                    placeholder={t('waitlist.email.placeholder')}
                    required 
                    aria-describedby="email-help"
                  />
                  <div id="email-help" class="input-help">{t('waitlist.email.help')}</div>
                </div>
                
                <div class="checkbox-container">
                  <label class="checkbox-label">
                    <input 
                      type="checkbox" 
                      id="emailConsent" 
                      checked 
                      required
                    />
                    <span class="checkmark"></span>
                    {t('waitlist.consent')}
                  </label>
                </div>
                
                <button type="submit" class="btn btn-primary">{t('waitlist.submit')}</button>
              </form>
            </div>
          </div>
        </div>
      </section>

      <div class="loading-container" id="loadingContainer" style="display: none;">
        <div class="loading-spinner" id="spinner" aria-hidden="true"></div>
        <p class="loading-text" id="loadingText">{t('loading.calculating')}</p>
      </div>
    </section>
  </main>
</Layout>

<script is:inline>
  // Store current language for JavaScript functions
  window.currentLang = document.documentElement.lang;
  
  // Function to scroll to waitlist form
  function scrollToWaitlist() {
    console.log('scrollToWaitlist called');
    const waitlistSection = document.querySelector('.email-capture');
    const emailForm = document.getElementById('emailForm');
    const waitlistSectionAlt = document.querySelector('.waitlist-section');
    
    console.log('Found elements:', {
      waitlistSection: !!waitlistSection,
      emailForm: !!emailForm,
      waitlistSectionAlt: !!waitlistSectionAlt
    });
    
    // Try multiple selectors to find the right element
    const targetElement = waitlistSection || emailForm || waitlistSectionAlt;
    
    if (targetElement) {
      targetElement.scrollIntoView({ 
        behavior: 'smooth', 
        block: 'center' 
      });
      console.log('Scrolling to element:', targetElement);
    } else {
      console.error('Could not find waitlist section to scroll to');
    }
  }
  
  // Make function globally accessible
  window.scrollToWaitlist = scrollToWaitlist;
  
  // Format currency based on current language
  function formatCurrency(amount, lang = window.currentLang) {
    const locales = {
      en: 'en-US', es: 'es-ES', fr: 'fr-FR', pl: 'pl-PL',
      ar: 'ar-SA', ru: 'ru-RU', zh: 'zh-CN', it: 'it-IT', ja: 'ja-JP'
    };

    const currencies = {
      en: 'USD', es: 'EUR', fr: 'EUR', pl: 'PLN',
      ar: 'SAR', ru: 'RUB', zh: 'CNY', it: 'EUR', ja: 'JPY'
    };

    try {
      return new Intl.NumberFormat(locales[lang] || 'en-US', {
        style: 'currency',
        currency: currencies[lang] || 'USD',
        minimumFractionDigits: lang === 'ja' ? 0 : 2,
        maximumFractionDigits: lang === 'ja' ? 0 : 2,
      }).format(amount);
    } catch (error) {
      return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
      }).format(amount);
    }
  }

  // Main calculator logic
  document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded, looking for elements...');
    
    // Add click event listener to pilot CTA button as backup
    const pilotButton = document.querySelector('.pilot-cta-button');
    if (pilotButton) {
      pilotButton.addEventListener('click', function(e) {
        e.preventDefault();
        scrollToWaitlist();
      });
      console.log('Pilot button event listener added');
    }
    
    const form = document.getElementById('revenueCalculator');
    const emailForm = document.getElementById('emailForm');
    const resultsSection = document.getElementById('results');
    const loadingContainer = document.getElementById('loadingContainer');
    const loadingText = document.getElementById('loadingText');
    const rebookRateInput = document.getElementById('rebookRate');
    
    console.log('Elements found:', {
      form: !!form,
      emailForm: !!emailForm,
      resultsSection: !!resultsSection,
      loadingContainer: !!loadingContainer,
      rebookRateInput: !!rebookRateInput
    });

    // Handle rebooking rate validation
    if (rebookRateInput) {
      rebookRateInput.addEventListener('input', function(e) {
        const value = parseFloat(e.target.value);
        if (value > 85) {
          e.target.value = 85;
          const messages = {
            en: 'Excellent! Your rebooking rate is already above industry standards. We have set it to 85% for the most accurate comparison.',
            es: '¡Excelente! Tu tasa de rebooking ya está por encima de los estándares de la industria. La hemos establecido en 85% para la comparación más precisa.',
            fr: 'Excellent ! Votre taux de rebooking est déjà au-dessus des standards de industrie. Nous avons fixé à 85% pour la comparaison la plus précise.',
            pl: 'Świetnie! Twój wskaźnik rebookingu jest już powyżej standardów branżowych. Ustawiliśmy go na 85% dla najdokładniejszego porównania.',
            ar: 'ممتاز! معدل إعادة الحجز لديك أعلى من معايير الصناعة. قمنا بتعيينه على 85% للمقارنة الأكثر دقة.',
            ru: 'Отлично! Ваш уровень перебронирования уже выше отраслевых стандартов. Мы установили его на 85% для наиболее точного сравнения.',
            zh: '太棒了！您的重新预约率已经超过行业标准。我们将其设置为85%以进行最准确的比较。',
            it: 'Eccellente! Il tuo tasso di ribooking è già sopra gli standard del settore. Lo abbiamo impostato a 85% per il confronto più accurato.',
            ja: '素晴らしい！あなたの再予約率はすでに業界標準を上回っています。最も正確な比較のために85%に設定しました。'
          };
          
          const message = messages[window.currentLang] || messages.en;
          alert(message);
        }
      });
    }

    if (form) {
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form values
        const monthlyClients = parseFloat(document.getElementById('monthlyClients').value) || 200;
        const avgTicket = parseFloat(document.getElementById('avgTicket').value) || 75;
        const rebookRate = Math.min(85, Math.max(0, parseFloat(document.getElementById('rebookRate').value) || 40));
        // const avgVisitsYear = parseFloat(document.getElementById('avgVisitsYear').value) || 6;
        
        // Validation
        if (monthlyClients <= 0 || avgTicket <= 0 || rebookRate < 0 || rebookRate > 85) {
          alert('Please enter valid values. Rebooking rate must be between 0-85%.');
          return;
        }
        
        // Show loading
        loadingContainer.style.display = 'flex';
        loadingText.textContent = window.currentLang === 'en' ? 'Calculating your revenue potential...' :
          window.currentLang === 'es' ? 'Calculando tu potencial de ingresos...' :
          window.currentLang === 'fr' ? 'Calcul de votre potentiel de revenus...' :
          window.currentLang === 'pl' ? 'Obliczanie twojego potencjału przychodów...' :
          window.currentLang === 'ar' ? 'حساب إمكانات الإيرادات الخاصة بك...' :
          window.currentLang === 'ru' ? 'Расчитываем ваш потенциал доходов...' :
          window.currentLang === 'zh' ? '计算您的收入潜力...' :
          window.currentLang === 'it' ? 'Calcolo del tuo potenziale di ricavi...' :
          window.currentLang === 'ja' ? 'あなたの収益ポテンシャルを計算中...' :
          'Calculating your revenue potential...';
          
        // Switch to analyzing text after 1 second
        setTimeout(() => {
          if (loadingContainer.style.display === 'flex') {
            loadingText.textContent = window.currentLang === 'en' ? 'Analyzing your data with AI...' :
              window.currentLang === 'es' ? 'Analizando tus datos con IA...' :
              window.currentLang === 'fr' ? 'Analyse de vos données avec l\'IA...' :
              window.currentLang === 'pl' ? 'Analizowanie twoich danych z AI...' :
              window.currentLang === 'ar' ? 'تحليل بياناتك باستخدام الذكاء الاصطناعي...' :
              window.currentLang === 'ru' ? 'Анализируем ваши данные с помощью ИИ...' :
              window.currentLang === 'zh' ? '使用AI分析您的数据...' :
              window.currentLang === 'it' ? 'Analisi dei tuoi dati con IA...' :
              window.currentLang === 'ja' ? 'AIでデータを分析中...' :
              'Analyzing your data with AI...';
          }
        }, 1000);
        
        setTimeout(() => {
          // Calculate metrics
          const currentMonthlyRevenue = monthlyClients * avgTicket;
          
          // Calculate potential with improved rebooking
          const idealRebookRate = Math.max(85, rebookRate + 5); // At least 5% improvement or 85% max
          const rebookImprovement = Math.max(0, (idealRebookRate - rebookRate) / 100);
          const additionalRebookings = monthlyClients * rebookImprovement;
          const lostMonthlyRevenue = Math.max(0, additionalRebookings * avgTicket);
          const potentialMonthlyRevenue = currentMonthlyRevenue + lostMonthlyRevenue;
          
          // Annual calculations
          const annualOpportunity = lostMonthlyRevenue * 12;
          const lostPercentage = potentialMonthlyRevenue > 0 ? ((lostMonthlyRevenue / potentialMonthlyRevenue) * 100).toFixed(1) : '0.0';
          
          // Update display
          document.getElementById('currentRevenue').textContent = formatCurrency(currentMonthlyRevenue);
          document.getElementById('lostRevenue').textContent = formatCurrency(lostMonthlyRevenue);
          document.getElementById('potentialRevenue').textContent = formatCurrency(potentialMonthlyRevenue);
          document.getElementById('annualOpportunity').textContent = formatCurrency(annualOpportunity);
          document.getElementById('lostPercentage').textContent = lostPercentage + '%';
          document.getElementById('increaseAmount').textContent = formatCurrency(lostMonthlyRevenue);
          
          // Hide loading and show results
          loadingContainer.style.display = 'none';
          resultsSection.classList.add('show');
          resultsSection.style.display = 'block';
          
          // Scroll to results
          resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
          
          // Analytics tracking
          if (typeof gtag !== 'undefined') {
            gtag('event', 'calculator_completed', {
              event_category: 'engagement',
              event_label: 'revenue_calculation',
              value: Math.round(lostMonthlyRevenue)
            });
          }
          
          if (typeof fbq !== 'undefined') {
            fbq('track', 'CompleteRegistration', {
              content_name: 'Revenue Calculator',
              value: Math.round(lostMonthlyRevenue),
              currency: currencies[window.currentLang] || 'USD'
            });
          }
          
        }, 1500);
      });
    }

    // Email form handling
    console.log('Looking for emailForm element:', emailForm);
    if (emailForm) {
      console.log('Email form found, adding event listener');
      emailForm.addEventListener('submit', async function(e) {
        console.log('Form submission triggered');
        e.preventDefault();
        
        const email = document.getElementById('email').value;
        const emailConsent = document.getElementById('emailConsent').checked;
        const submitButton = emailForm.querySelector('button[type="submit"]');
        const originalText = submitButton.textContent;
        
        if (!email || !email.includes('@')) {
          alert('Please enter a valid email address');
          return;
        }
        
        if (!emailConsent) {
          alert('Please agree to receive updates to join the waitlist');
          return;
        }
        
        submitButton.textContent = '...';
        submitButton.disabled = true;
        
        try {
          // Create form data for webhook submission
          const formData = new FormData();
          formData.append('product', 'revenueSaaS');
          formData.append('email', email);
          formData.append('isAgreedToReceiveMails', 'true');
          
          console.log('Sending webhook data:', {
            product: 'revenueSaaS',
            email: email,
            isAgreedToReceiveMails: true
          });
          
          const response = await fetch('https://n8n.aiadaptiv.com/webhook/a5fca94e-b74b-4a0f-847e-13b944c4bdf6', {
            method: 'POST',
            body: formData
          });
          
          console.log('Webhook response status:', response.status);
          console.log('Webhook response ok:', response.ok);
          
          if (response.ok || response.status === 0) {
            // Success feedback
            submitButton.textContent = '✓ Sent!';
            submitButton.style.background = 'var(--success)';
            
            console.log('Webhook submission successful');
            
            // Analytics
            if (typeof gtag !== 'undefined') {
              gtag('event', 'email_submitted', {
                event_category: 'conversion',
                event_label: 'waitlist_signup'
              });
            }
            
            if (typeof fbq !== 'undefined') {
              fbq('track', 'Lead', {
                content_name: 'Waitlist Signup'
              });
            }
            
            // Reset after delay
            setTimeout(() => {
              submitButton.textContent = originalText;
              submitButton.disabled = false;
              submitButton.style.background = '';
              emailForm.reset();
              document.getElementById('emailConsent').checked = true; // Reset checkbox to checked
            }, 3000);
          } else {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
          
        } catch (error) {
          console.error('Webhook submission failed:', error);
          console.error('Error details:', {
            name: error.name,
            message: error.message,
            stack: error.stack
          });
          
          submitButton.textContent = 'Error - Try Again';
          submitButton.disabled = false;
          
          // Show detailed error to user for debugging
          alert(`Webhook error: ${error.message}. Check browser console for details.`);
          
          // Reset to original after delay
          setTimeout(() => {
            submitButton.textContent = originalText;
            submitButton.style.background = '';
          }, 3000);
        }
      });
    }
  });
</script>

<style>
  /* All styles from RevenueCalculator.astro */
  .visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  .background-pattern {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0.1;
    background-image: 
      repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(255,255,255,.1) 35px, rgba(255,255,255,.1) 70px);
    pointer-events: none;
  }

  .calculator-container {
    background: white;
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    max-width: 600px;
    width: 100%;
    overflow: hidden;
    position: relative;
    animation: slideUp 0.6s ease-out;
    margin-top: 40px;
  }

  .header-language-selector {
    margin: 16px 0;
    display: flex;
    justify-content: center;
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .header {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    padding: 30px 24px;
    text-align: center;
    color: white;
    position: relative;
  }

  .badge {
    display: inline-block;
    background: rgba(255, 255, 255, 0.2);
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 16px;
    backdrop-filter: blur(10px);
  }

  h1 {
    font-size: 2rem;
    margin-bottom: 12px;
    font-weight: 700;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .subtitle {
    font-size: 1rem;
    opacity: 0.95;
    max-width: 400px;
    margin: 0 auto;
    line-height: 1.5;
  }

  .calculator-body {
    padding: 30px 24px;
  }

  .input-group {
    margin-bottom: 20px;
    animation: fadeIn 0.8s ease-out forwards;
    opacity: 0;
  }

  .input-group:nth-child(2) { animation-delay: 0.1s; }
  .input-group:nth-child(3) { animation-delay: 0.2s; }
  .input-group:nth-child(4) { animation-delay: 0.3s; }
  .input-group:nth-child(5) { animation-delay: 0.4s; }

  @keyframes fadeIn {
    to {
      opacity: 1;
    }
  }

  label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: var(--dark);
    font-size: 0.95rem;
  }

  .input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
  }

  .input-icon {
    position: absolute;
    left: 16px;
    color: var(--primary);
    width: 20px;
    height: 20px;
    z-index: 1;
  }

  .badge-icon {
    width: 16px;
    height: 16px;
    display: inline-block;
    margin-right: 8px;
    vertical-align: middle;
  }

  .help-icon {
    width: 16px;
    height: 16px;
    flex-shrink: 0;
  }

  .metric-icon {
    width: 16px;
    height: 16px;
    flex-shrink: 0;
  }

  .email-icon {
    width: 18px;
    height: 18px;
    display: inline-block;
    margin-right: 8px;
    vertical-align: middle;
  }

  input[type="number"],
  input[type="email"],
  input[type="text"],
  input[type="tel"] {
    width: 100%;
    padding: 14px 16px 14px 48px;
    border: 2px solid #E5E7EB;
    border-radius: 12px;
    font-size: 16px;
    transition: all 0.3s ease;
    background: #FAFAFA;
  }

  /* RTL adjustments */
  [dir="rtl"] input[type="number"],
  [dir="rtl"] input[type="email"],
  [dir="rtl"] input[type="text"],
  [dir="rtl"] input[type="tel"] {
    padding: 14px 48px 14px 16px;
  }

  [dir="rtl"] .input-icon {
    left: auto;
    right: 16px;
  }

  input:focus {
    outline: none;
    border-color: var(--primary);
    background: white;
    box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
  }

  .help-text {
    font-size: 0.85rem;
    color: #6B7280;
    margin-top: 6px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .results-section {
    background: linear-gradient(135deg, #F3F4F6 0%, #FAFAFF 100%);
    padding: 32px;
    border-radius: 16px;
    margin-top: 32px;
    display: none;
    border: 2px solid #E5E7EB;
  }

  .results-section.show {
    display: block;
    animation: slideIn 0.5s ease-out;
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .metric-card {
    background: white;
    padding: 24px;
    border-radius: 12px;
    margin-bottom: 20px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    border: 1px solid #E5E7EB;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .metric-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 12px rgba(0, 0, 0, 0.1);
  }

  .highlight-card {
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
  }

  .metric-label {
    font-size: 0.9rem;
    color: #6B7280;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .metric-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--dark);
    margin-bottom: 4px;
  }

  .metric-value.highlight {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .metric-change {
    font-size: 0.95rem;
    color: var(--success);
    display: flex;
    align-items: center;
    gap: 4px;
  }

  /* Calculation explanation styles */
  .calculation-explanation {
    background: linear-gradient(135deg, #F0F9FF 0%, #E0F2FE 100%);
    padding: 24px;
    border-radius: 16px;
    margin-bottom: 32px;
    border: 2px solid #0EA5E9;
    border-opacity: 0.2;
  }

  .explanation-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--dark);
    margin-bottom: 16px;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .title-icon {
    width: 24px;
    height: 24px;
    color: var(--primary);
  }

  .explanation-content p {
    color: #374151;
    font-size: 1rem;
    margin-bottom: 20px;
    text-align: center;
  }

  .calculation-steps {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .step {
    display: flex;
    align-items: center;
    gap: 16px;
    background: white;
    padding: 16px;
    border-radius: 12px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  }

  .step-number {
    background: var(--primary);
    color: white;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    flex-shrink: 0;
  }

  .step-content {
    color: var(--dark);
    font-size: 0.95rem;
    line-height: 1.4;
  }

  /* Solution explanation styles */
  .solution-explanation {
    background: linear-gradient(135deg, #F0FDF4 0%, #ECFDF5 100%);
    padding: 32px;
    border-radius: 20px;
    margin: 32px 0;
    border: 2px solid #10B981;
    border-opacity: 0.2;
  }

  .solution-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--dark);
    margin-bottom: 16px;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .solution-intro {
    font-size: 1.1rem;
    color: #374151;
    text-align: center;
    margin-bottom: 24px;
    font-weight: 500;
  }

  .solution-features {
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
    margin-bottom: 32px;
  }

  .solution-feature {
    background: white;
    padding: 24px;
    border-radius: 16px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    border: 1px solid #E5E7EB;
  }

  .solution-feature.highlight-feature {
    background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
    border-color: #F59E0B;
  }

  .feature-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
  }

  .feature-icon {
    width: 20px;
    height: 20px;
    color: var(--primary);
    flex-shrink: 0;
  }

  .feature-header h4 {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--dark);
    margin: 0;
  }

  .solution-feature p {
    color: #4B5563;
    font-size: 0.95rem;
    line-height: 1.5;
    margin: 0;
  }

  .pilot-program {
    background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
    padding: 24px;
    border-radius: 16px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    border: 2px solid #F59E0B;
  }

  .pilot-header {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 16px;
  }

  .pilot-icon {
    width: 24px;
    height: 24px;
    color: #F59E0B;
  }

  .pilot-header h4 {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--dark);
    margin: 0;
  }

  .pilot-content p {
    color: #374151;
    font-size: 1rem;
    line-height: 1.5;
    margin-bottom: 16px;
  }

  .pilot-features {
    list-style: none;
    padding: 0;
    margin: 16px 0;
  }

  .pilot-features li {
    color: #374151;
    font-size: 0.95rem;
    line-height: 1.5;
    margin-bottom: 8px;
    padding-left: 20px;
    position: relative;
  }

  .pilot-features li::before {
    content: "✓";
    position: absolute;
    left: 0;
    color: #10B981;
    font-weight: bold;
    font-size: 1rem;
  }

  .pilot-cta-button {
    background: white;
    padding: 16px 24px;
    border-radius: 12px;
    text-align: center;
    font-weight: 600;
    color: var(--primary);
    border: 2px solid var(--primary);
    margin-top: 16px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 1rem;
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .pilot-cta-button:hover {
    background: var(--primary);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(139, 92, 246, 0.3);
  }

  .cta-icon {
    width: 16px;
    height: 16px;
  }

  .cta-section {
    margin-top: 32px;
    padding: 32px;
    background: linear-gradient(135deg, rgba(139, 92, 246, 0.05) 0%, rgba(236, 72, 153, 0.05) 100%);
    border-radius: 16px;
    border: 2px dashed rgba(139, 92, 246, 0.3);
  }

  /* Promotional section styles */
  .promo-section {
    text-align: center;
    margin-bottom: 40px;
    padding-bottom: 32px;
    border-bottom: 2px solid rgba(139, 92, 246, 0.1);
  }

  .promo-title {
    font-size: 1.6rem;
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 12px;
  }

  .promo-subtitle {
    color: var(--dark);
    margin-bottom: 24px;
    font-size: 1.1rem;
    font-weight: 600;
  }

  .features-list {
    display: flex;
    flex-direction: column;
    gap: 16px;
    max-width: 500px;
    margin: 0 auto;
  }

  .feature-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 16px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    text-align: left;
  }

  .feature-icon {
    width: 20px;
    height: 20px;
    color: var(--success);
    flex-shrink: 0;
    margin-top: 2px;
  }

  .feature-item span {
    color: var(--dark);
    font-size: 0.95rem;
    line-height: 1.4;
  }

  /* Waitlist section styles */
  .waitlist-section {
    text-align: center;
  }

  .waitlist-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--dark);
    margin-bottom: 12px;
  }

  .waitlist-subtitle {
    color: #6B7280;
    margin-bottom: 24px;
    font-size: 1.05rem;
  }

  .schedule-call-section {
    margin: 20px 0;
    text-align: center;
  }

  .schedule-text {
    color: #6B7280;
    font-size: 1rem;
    margin-bottom: 12px;
    font-weight: 500;
  }

  .schedule-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    background: linear-gradient(135deg, #10B981 0%, #059669 100%);
    color: white;
    text-decoration: none;
    border-radius: 10px;
    font-weight: 600;
    font-size: 0.95rem;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
  }

  .schedule-link:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
    text-decoration: none;
  }

  .calendar-icon {
    width: 18px;
    height: 18px;
  }

  .btn {
    padding: 16px 32px;
    border: none;
    border-radius: 12px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
    position: relative;
    overflow: hidden;
  }

  .btn-primary {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    color: white;
    box-shadow: 0 4px 14px rgba(139, 92, 246, 0.4);
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.5);
  }

  .btn-primary:focus {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
  }

  .btn-primary::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
  }

  .btn-primary:active::after {
    width: 300px;
    height: 300px;
  }

  .email-capture {
    background: white;
    padding: 32px;
    border-radius: 16px;
    margin-top: 20px;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
    border: 1px solid #E5E7EB;
  }

  .email-form {
    display: flex;
    flex-direction: column;
    gap: 20px;
    max-width: 350px;
    margin: 0 auto;
  }

  .email-input-container {
    text-align: left;
  }

  .email-label {
    display: block;
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--dark);
    margin-bottom: 6px;
  }

  #email {
    width: 100% !important;
    max-width: none !important;
    padding: 14px 16px !important;
    border: 2px solid #E5E7EB !important;
    border-radius: 12px !important;
    font-size: 16px !important;
    background: #FAFAFA !important;
    transition: all 0.3s ease !important;
    box-sizing: border-box !important;
    margin: 0 !important;
  }

  #email:focus {
    outline: none !important;
    border-color: var(--primary) !important;
    background: white !important;
    box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1) !important;
  }

  .input-help {
    font-size: 0.8rem;
    color: #6B7280;
    margin-top: 4px;
    font-style: italic;
  }

  .checkbox-container {
    margin: 8px 0;
  }

  .checkbox-label {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    font-size: 14px;
    color: var(--dark);
    cursor: pointer;
    line-height: 1.4;
    text-align: left;
  }

  .checkbox-label input[type="checkbox"] {
    margin: 0;
    cursor: pointer;
    flex-shrink: 0;
  }

  .email-form .btn {
    margin-top: 8px;
  }

  .trust-indicators {
    display: flex;
    justify-content: center;
    gap: 40px;
    margin-top: 32px;
    padding-top: 32px;
    border-top: 1px solid #E5E7EB;
    flex-wrap: wrap;
  }

  .trust-item {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #6B7280;
    font-size: 0.9rem;
  }

  .trust-item svg {
    color: var(--success);
  }

  .loading-container {
    text-align: center;
    padding: 40px;
    background: rgba(255, 255, 255, 0.95);
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    backdrop-filter: blur(5px);
  }

  .loading-spinner {
    width: 40px;
    height: 40px;
    border: 4px solid #E5E7EB;
    border-top-color: var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 16px;
  }

  .loading-text {
    color: var(--dark);
    font-size: 1rem;
    font-weight: 500;
    margin: 0;
    animation: pulse 2s ease-in-out infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
  }

  @media (max-width: 768px) {
    .calculator-container {
      max-width: 95%;
      margin: 20px auto;
    }
    
    h1 {
      font-size: 1.6rem;
    }
    
    .header {
      padding: 24px 20px;
    }
    
    .calculator-body {
      padding: 20px;
    }
    
    .input-group {
      margin-bottom: 16px;
    }
    
    .email-form {
      flex-direction: column;
    }
    
    .metric-value {
      font-size: 2rem;
    }

    .trust-indicators {
      gap: 20px;
    }

    .calculation-explanation,
    .solution-explanation {
      padding: 20px;
      margin: 20px 0;
    }

    .solution-features {
      gap: 16px;
    }

    .solution-feature {
      padding: 20px;
    }

    .step {
      padding: 12px;
    }

    .step-number {
      width: 28px;
      height: 28px;
      font-size: 0.9rem;
    }

    .explanation-title,
    .solution-title {
      font-size: 1.2rem;
    }

    .pilot-program {
      padding: 20px;
    }

    .pilot-header h4 {
      font-size: 1.1rem;
    }

    .pilot-features li {
      font-size: 0.9rem;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .calculator-container,
    .input-group,
    .results-section {
      animation: none;
    }
    
    .btn {
      transition: none;
    }
  }
</style>